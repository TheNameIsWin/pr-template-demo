name: PR Template Selector

on:
  pull_request:
    types: [opened, edited]

jobs:
  template-selector:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Determine template
        id: template
        run: |
          # Check if changes are in frontend folder
          if git diff --name-only origin/main...HEAD | grep -q "^frontend/"; then
            echo "template=frontend" >> $GITHUB_OUTPUT
            echo "🎨 Frontend changes detected - using frontend template"
          # Check if changes are in backend folder
          elif git diff --name-only origin/main...HEAD | grep -q "^backend/"; then
            echo "template=backend" >> $GITHUB_OUTPUT
            echo "⚙️ Backend changes detected - using backend template"
          else
            echo "template=default" >> $GITHUB_OUTPUT
            echo "📝 Using default template"
          fi

      - name: Comment on PR
        uses: actions/github-script@v6
        with:
          script: |
            const template = '${{ steps.template.outputs.template }}';
            let message = '';
            
            if (template === 'frontend') {
              message = `🎨 **Frontend PR Detected!**
              
              This PR contains frontend changes. Please use the **Frontend PR Template** when creating your PR.
              
              **Template Location:** \`.github/PULL_REQUEST_TEMPLATE/frontend.md\`
              
              **Features:**
              - UI/UX specific checkboxes
              - Browser compatibility testing
              - Responsive design checks
              - Frontend testing requirements`;
            } else if (template === 'backend') {
              message = `⚙️ **Backend PR Detected!**
              
              This PR contains backend changes. Please use the **Backend PR Template** when creating your PR.
              
              **Template Location:** \`.github/PULL_REQUEST_TEMPLATE/backend.md\`
              
              **Features:**
              - Database change tracking
              - API documentation requirements
              - Security checklist
              - Performance considerations`;
            } else {
              message = `📝 **General PR**
              
              This PR contains mixed or general changes. You can use any template that fits your needs.`;
            }
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });
